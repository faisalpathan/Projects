/*!
 * jQuery Loupe
 * http://www.userdot.net/#!/jquery
 *
 * Copyright 2011, UserDot www.userdot.net
 * Licensed under the GPL Version 3 license.
 * Version 1.0.0
 *
 */
!function(a){var b=0;jQuery.fn.loupe=function(c){if(b++,this.length>1)return this.each(function(){a(this).loupe(c)});var h,u,c=a.extend({trigger:"mouseenter",shape:"circle",rounded_corners:10,loupe_toggle_time:"medium",loupe_toggle_easing:"linear",default_size:200,min_size:150,max_size:250,glossy:!0,drop_shadow:!0,allow_resize:!0,size_snap:10,resize_animation_time:"medium",resize_animation_easing:"easeOutBack",allow_zoom:!0,zoom_key:90,default_zoom:100,min_zoom:50,max_zoom:200,zoom_snap:5,zoom_animation_time:"medium",zoom_animation_easing:"easeOutBack",apply_overlay:!0,overlay_opacity:.5,overlay_effect_time:"slow",overlay_effect_easing:"easeOutBack",overlay_class_name:""},c||{}),d=jQuery(this),e="loupe-"+b,f="loupe_overlay-"+b,g=c.default_size,i=null,j=0,k=0,l=0,m=0,n=0,o=0,p=!1,q=!1,r=c.default_zoom,s=0,t=0,v=!1;return this.each(function(){function b(){var b=g-2*a("#"+e+" .glossy").css("marginTop"),d=g/2,f=0,h=0;"circle"==c.shape?h=f=d:"rounded"==c.shape&&(f=parseInt(a("#"+e).css("border-top-width")),h=f=c.rounded_corners-f),a("#"+e+" .glossy").stop(),a("#"+e+" .glossy").animate({width:b+"px",height:d+"px","-webkit-border-top-left-radius":f+"px","-webkit-border-top-right-radius":h+"px","-moz-border-radius-topleft":f+"px","-moz-border-radius-topright":h+"px","border-top-left-radius":f+"px","border-top-right-radius":h+"px"},{queue:!1,easing:c.resize_animation_easing,duration:c.resize_animation_time})}function w(f,i){if(p&&c.allow_zoom){if(!(r+c.zoom_snap*f>c.max_zoom||r+c.zoom_snap*f<c.min_zoom)){r+=c.zoom_snap*f,a("#log").text("zoom: "+r),n+=Math.round(l*c.zoom_snap/100)*f,o+=Math.round(m*c.zoom_snap/100)*f;var q=i.pageY-this.offsetTop;s=Math.round(n/j*(i.pageX-this.offsetLeft))*-1+g/2,t=Math.round(o/k*q)*-1+g/2,a("#"+e).animate({"background-position":s+"px "+t+"px","background-size":n+"px "+o+"px"},{queue:!1,easing:c.zoom_animation_easing,duration:c.zoom_animation_time,complete:function(){h=a("#"+e).outerWidth();var b=new jQuery.Event("mousemove",{pageX:v+h/2,pageY:w+h/2});d.trigger(b)}})}}else if(c.allow_resize&&!p&&(q=f*c.size_snap,!(g+q>c.max_size||g+q<c.min_size))){g+=q;var u=0,v=Math.round(a("#"+e).offset().left-q),w=Math.round(a("#"+e).offset().top-q);s+=q,t+=q,a("#"+e).stop(),"circle"==c.shape?(u=g/2,a("#"+e).animate({width:g+"px",height:g+"px","-webkit-border-top-left-radius":u+"px","-webkit-border-top-right-radius":u+"px","-webkit-border-bottom-left-radius":u+"px","-webkit-border-bottom-right-radius":u+"px","-moz-border-radius-topleft":u+"px","-moz-border-radius-topright":u+"px","-moz-border-radius-bottomleft":u+"px","-moz-border-radius-bottomright":u+"px","border-top-left-radius":u+"px","border-top-right-radius":u+"px","border-bottom-left-radius":u+"px","border-bottom-right-radius":u+"px","background-position":s+"px "+t+"px",left:v+"px",top:w+"px"},{queue:!1,easing:c.resize_animation_easing,duration:c.resize_animation_time,complete:function(){h=a("#"+e).outerWidth();var b=new jQuery.Event("mousemove",{pageX:v+h/2,pageY:w+h/2});d.trigger(b)}})):"rounded"==c.shape?a("#"+e).animate({width:g+"px",height:g+"px","-webkit-border-radius":c.rounded_corners,"-moz-border-radius":c.rounded_corners,"border-radius":c.rounded_corners,"background-position":s+"px "+t+"px",left:v+"px",top:w+"px"},{queue:!1,easing:c.resize_animation_easing,duration:c.resize_animation_time,complete:function(){h=a("#"+e).outerWidth();var b=new jQuery.Event("mousemove",{pageX:v+h/2,pageY:w+h/2});d.trigger(b)}}):"square"==c.shape&&a("#"+e).animate({width:g+"px",height:g+"px","background-position":s+"px "+t+"px",left:v+"px",top:w+"px"},{queue:!1,easing:c.resize_animation_easing,duration:c.resize_animation_time,complete:function(){h=a("#"+e).outerWidth();var b=new jQuery.Event("mousemove",{pageX:v+h/2,pageY:w+h/2});d.trigger(b)}}),c.glossy&&b()}}jQuery.browser.webkit&&"complete"!=document.readyState?setTimeout(arguments.callee,100):(function(){d.is("a")?(i=d.attr("href"),u=d.find("img")):d.is("img")&&(i=d.attr("src"),u=d),jQuery.browser.msie&&parseInt(jQuery.browser.version,10)<9&&(v=!0,r=100),j=u.width(),k=u.height(),a("body").append("<div class='sc__loupe' id='"+e+"'></div>");var b=new Image;b.onload=function(){l=this.width,m=this.height,n=Math.round(l*r/100),o=Math.round(m*r/100);var b=g/2;a("#"+e).css({width:g+"px",height:g+"px","background-image":"url("+i+")","background-size":n+"px "+o+"px"}),"circle"==c.shape?a("#"+e).css({"-webkit-border-radius":b+"px","-moz-border-radius":b+"px","border-radius":b+"px"}):"rounded"==c.shape&&a("#"+e).css({"-webkit-border-radius":c.rounded_corners,"-moz-border-radius":c.rounded_corners,"border-radius":c.rounded_corners+"px"}),h=a("#"+e).outerWidth(),c.glossy&&a("#"+e).append("<div class='glossy'></div>"),c.apply_overlay&&(a("body").append("<div class='overlay "+c.overlay_class_name+"' id='"+f+"'></div>"),a("#"+f).css({top:u.offset().top+"px",left:u.offset().left+"px",width:u.outerWidth()+"px",height:u.outerHeight()+"px"})),c.drop_shadow&&a("#"+e).addClass("shadow")},b.src=i}(),(c.allow_resize||c.allow_zoom)&&!v&&a.event.special.mousewheel&&a("#"+e).bind("mousewheel",function(a,b){return w(b,a),!1}),u.bind(c.trigger,function(d){if(q?(a("#"+e).fadeOut(c.loupe_toggle_time,c.loupe_toggle_easing),q=!1,c.apply_overlay&&a("#"+f).fadeOut(c.overlay_effect_time,c.overlay_effect_easing)):(a("#"+e).fadeIn(c.loupe_toggle_time,c.loupe_toggle_easing),q=!0,c.apply_overlay&&a("#"+f).fadeTo(c.overlay_effect_time,c.overlay_opacity,c.overlay_effect_easing),b()),"click"==d.type)return d.preventDefault?d.preventDefault():d.returnValue=!1,!1}),a("#"+e).bind("click",function(){u.trigger("click")}),a(document).bind("mousemove",function(b){if(!q)return!0;var d=parseInt(u.css("border-left-width"))+parseInt(u.css("padding-left")),i=parseInt(u.css("border-top-width"))+parseInt(u.css("padding-top")),l=parseInt(u.css("border-right-width"))+parseInt(u.css("padding-right")),m=parseInt(u.css("border-bottom-width"))+parseInt(u.css("padding-bottom")),p=b.pageX-u.offset().left-d,r=b.pageY-u.offset().top-i,v=Math.round(b.pageX-h/2),b=Math.round(b.pageY-h/2);s=Math.round(n/j*p)*-1+g/2,t=Math.round(o/k*r)*-1+g/2,a("#"+e).css({"background-position":s+"px "+t+"px"}),a("#"+e).css({left:v+"px",top:b+"px"}),(p<-d||r<-i||p>j+l||r>k+m)&&(a("#"+e).fadeOut(c.loupe_toggle_time),q=!1,c.apply_overlay&&a("#"+f).fadeOut(c.overlay_effect_time))}),a(document).keyup(function(a){if(a.which==c.zoom_key&&q)return p=!1,a.preventDefault?a.preventDefault():a.returnValue=!1,!1}).keydown(function(a){if(a.which==c.zoom_key&&q)return p=!0,a.preventDefault?a.preventDefault():a.returnValue=!1,!1}))})}}(jQuery);