/*
Easy video background jquery plugin
 */
!function(){function i(){var i=navigator.userAgent.toLowerCase();return-1!=i.indexOf("msie")?parseInt(i.split("msie")[1]):!1}if(void 0==jQuery)return void console.log("Jquery not included!");if (typeof Modernizr != 'object') { console.log("Modernizr not included!"); return; if(void 0==Modernizr.video) {console.log("Modernizr not including video!"); return; } } var t=jQuery,e=i(),s=0,o=0;jQuery.fn.extend({ensureLoad:function(i){return this.each(function(){this.complete||4===this.readyState?i.call(this):"uninitialized"===this.readyState&&0===this.src.indexOf("data:")?(t(this).trigger("error"),i.call(this)):(t(this).one("load",i),e&&void 0!=this.src&&-1==this.src.indexOf("?")&&(this.src=this.src+"?"+(new Date).getTime()))})}}),video_background=function(i,e){return this.hidden=!1,this.$holder=i,this.id="video_background_video_"+s,s++,this.parameters={position:"absolute","z-index":"-1",video_ratio:!1,loop:!0,autoplay:!0,muted:!1,mp4:!1,webm:!1,ogg:!1,flv:!1,youtube:!1,priority:"html5",fallback_image:!1,sizing:"fill",start:0},t.each(e,t.proxy(function(i,t){this.parameters[i]=t},this)),this.$video_holder=t('<div id="'+this.id+'"></div>').appendTo(i).css({"z-index":this.parameters["z-index"],position:this.parameters.position,top:0,left:0,right:0,bottom:0,overflow:"hidden"}),this.ismobile=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i),this.supports_video=Modernizr.video&&(Modernizr.video.h264&&this.parameters.mp4!==!1||Modernizr.video.ogg&&this.parameters.ogg!==!1||Modernizr.video.webm&&this.parameters.webm!==!1),this.decision="image",this.ismobile||!this.supports_video&&this.parameters.youtube===!1||(this.decision=this.parameters.priority,this.parameters.youtube!==!1?this.decision="youtube":"html5"==this.parameters.priority&&this.supports_video?this.decision="html5":this.supports_video&&(this.decision="html5")),"image"==this.decision?this.make_image():"youtube"==this.decision?this.make_youtube():"html5"==this.decision&&this.make_video(),this},video_background.prototype={make_video:function(){var i=(this.parameters.autoplay?"autoplay ":"")+(this.parameters.loop?'loop onended="this.play()" ':""),e='<video width="100%" height="100%" '+i+">";this.parameters.mp4!==!1&&(e+='<source src="'+this.parameters.mp4+'" type="video/mp4"></source>'),this.parameters.webm!==!1&&(e+='<source src="'+this.parameters.webm+'" type="video/webm"></source>'),this.parameters.ogg!==!1&&(e+='<source src="'+this.parameters.ogg+'" type="video/ogg"></source>'),e+="</video>",this.$video=t(e).css({position:"absolute"}),this.$video_holder.append(this.$video),this.video=this.$video.get(0),this.parameters.video_ratio!==!1&&(this.resize_timeout=!1,t(window).resize(t.proxy(function(){clearTimeout(this.resize_timeout),this.resize_timeout=setTimeout(t.proxy(this.video_resize,this),10)},this)),this.video_resize()),this.parameters.muted&&this.mute()},video_resize:function(){var i=this.$video_holder.width(),t=this.$video_holder.height(),e=i,s=i/this.parameters.video_ratio;t>s&&(s=t,e=t*this.parameters.video_ratio),s=Math.ceil(s),e=Math.ceil(e);var o=Math.round(t/2-s/2),h=Math.round(i/2-e/2);this.$video.attr("width",e),this.$video.attr("height",s),this.$video.css({top:o+"px",left:h+"px"})},make_youtube:function(){var i=t("html");if(this.$video=t('<div id="'+this.id+'_yt"></div>').appendTo(this.$video_holder).css({position:"absolute"}),this.youtube_ready=!1,0==o){var e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(e,s),o=1,window.onYouTubeIframeAPIReady=t.proxy(function(){i.trigger("yt_loaded"),this.build_youtube(),o=2},this)}else 1==o?i.bind("yt_loaded",t.proxy(this.build_youtube,this)):2==o&&this.build_youtube()},build_youtube:function(){var i={loop:this.parameters.loop?1:0,start:this.parameters.start,autoplay:this.parameters.autoplay?1:0,controls:0,showinfo:0,wmode:"transparent",iv_load_policy:3,modestbranding:1,rel:0};this.parameters.loop&&(i.playlist=this.parameters.youtube),this.player=new YT.Player(this.id+"_yt",{height:"100%",width:"100%",playerVars:i,videoId:this.parameters.youtube,events:{onReady:t.proxy(this.youtube_ready_fun,this)}})},youtube_ready_fun:function(){this.youtube_ready=!0,this.$video=t("#"+this.id+"_yt"),this.parameters.video_ratio!==!1&&(this.resize_timeout=!1,t(window).resize(t.proxy(function(){clearTimeout(this.resize_timeout),this.resize_timeout=setTimeout(t.proxy(this.video_resize,this),10)},this)),this.video_resize()),this.parameters.muted&&this.mute()},make_image:function(){this.parameters.fallback_image!==!1&&(this.$img=t('<div style="background-image:url('+this.parameters.fallback_image+');" class="fallback_image"></div>').appendTo(this.$video_holder).css({position:"absolute"}),this.$img.ensureLoad(t.proxy(this.image_loaded,this)))},image_loaded:function(){this.original_width=this.$img.width(),this.original_height=this.$img.height(),this.resize_timeout=!1,t(window).resize(t.proxy(function(){clearTimeout(this.resize_timeout),this.resize_timeout=setTimeout(t.proxy(this.image_resize,this),10)},this)),this.image_resize()},image_resize:function(){var i=this.$video_holder.width(),t=this.$video_holder.height(),e=i,s=this.original_height/(this.original_width/i);("adjust"==this.parameters.sizing&&s>t||"fill"==this.parameters.sizing&&t>s)&&(s=t,e=this.original_width/(this.original_height/t)),s=Math.ceil(s),e=Math.ceil(e);var o=Math.round(t/2-s/2),h=Math.round(i/2-e/2);this.$img.css({width:e+"px",height:s+"px",top:o+"px",left:h+"px"})},isPlaying:function(){return"html5"==this.decision?!this.video.paused:"youtube"==this.decision&&this.youtube_ready?1===this.player.getPlayerState():!1},play:function(){"html5"==this.decision?this.video.play():"youtube"==this.decision&&this.youtube_ready&&this.player.playVideo()},pause:function(){"html5"==this.decision?this.video.pause():"youtube"==this.decision&&this.youtube_ready&&this.player.pauseVideo()},toggle_play:function(){this.isPlaying()?this.pause():this.play()},isMuted:function(){return"html5"==this.decision?!this.video.volume:"youtube"==this.decision&&this.youtube_ready?this.player.isMuted():!1},mute:function(){"html5"==this.decision?this.video.volume=0:"youtube"==this.decision&&this.youtube_ready&&this.player.mute()},unmute:function(){"html5"==this.decision?this.video.volume=1:"youtube"==this.decision&&this.youtube_ready&&this.player.unMute()},toggle_mute:function(){this.isMuted()?this.unmute():this.mute()},hide:function(){this.pause(),this.$video_holder.stop().fadeTo(700,0),this.hidden=!0},show:function(){this.play(),this.$video_holder.stop().fadeTo(700,1),this.hidden=!1},toogle_hidden:function(){this.hidden?this.show():this.hide()},rewind:function(){"html5"==this.decision?this.video.currentTime=0:"youtube"==this.decision&&this.youtube_ready&&this.player.seekTo(0)}}}(void 0);
